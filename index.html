<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íˆ¬ì–´ë©”ì´ì»¤ - ì„¸ê³„ ì—¬í–‰ ë§ˆìŠ¤í„° (Expert Mode)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&family=Roboto+Slab:wght@700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        #map { height: 350px; width: 100%; border-radius: 0.5rem; z-index: 1; }
        
        /* ì´ë¯¸ì§€ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .quiz-img { 
            height: 280px; 
            width: 100%; 
            object-fit: cover; 
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); 
            background-color: #f1f5f9;
        }
        
        .correct-anim { animation: bounce 0.5s; }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .modal-overlay { background-color: rgba(0, 0, 0, 0.85); }
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; background: #000; }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        
        .option-btn { min-height: 60px; }

        .brand-card {
            font-family: 'Roboto Slab', serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            color: #343a40;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.8rem 1.2rem;
            margin: 0.3rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            font-size: 1.0rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: transform 0.2s;
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen flex flex-col items-center">

    <!-- í—¤ë” -->
    <header class="w-full bg-white shadow-md p-4 flex justify-between items-center sticky top-0 z-50">
        <div class="flex items-center gap-3">
            <!-- íˆ¬ì–´ë©”ì´ì»¤ ë¡œê³  -->
            <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgHfgIX70O5k6Anuo0UgALIdaG9jSga9auHu3uyz0uEirylGPAJnjN_qQbvEGMUvPqUQf_g9FMNUHRxlDcUBf4vZ3Mpy4TnA9WxbmzWYK11gt2zuy_Irl4wctNFjcjLyPo0GPXV792o_J7L9guRMuDfeC1gy7USwywjYbECZgzcsHybuGRRAXAnO1eNmP8/s320/logo.png" 
                 alt="Tourmaker Logo" class="h-10 w-auto object-contain">
            <h1 class="text-xl font-bold text-slate-800 hidden sm:block">World Travel Master <span class="text-red-500 text-sm align-top">Expert</span></h1>
        </div>
        <div class="flex items-center gap-4">
            <div class="text-slate-600 font-medium">
                LV.<span id="level-display" class="font-bold text-slate-800">1</span>
            </div>
            <div class="text-slate-600 font-medium">
                Score: <span id="score" class="text-blue-600 font-bold text-lg">0</span>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ê²Œì„ ì˜ì—­ -->
    <main class="w-full max-w-2xl p-4 flex-grow flex flex-col gap-4">
        
        <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200 text-center">
            <span id="quiz-type-badge" class="inline-block px-3 py-1 rounded-full text-xs font-bold text-white bg-blue-500 mb-2">Quiz</span>
            <h2 id="question-title" class="text-xl font-black text-slate-800 mb-1">ì—¬í–‰ ì¤€ë¹„ ì¤‘...</h2>
            <p id="question-desc" class="text-sm text-slate-500">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
        </div>

        <div class="bg-white p-2 rounded-lg shadow-lg border border-slate-300 relative min-h-[300px] flex items-center justify-center overflow-hidden">
            
            <div id="map-container" class="w-full h-full hidden">
                <div id="map"></div>
                <div class="absolute bottom-4 right-4 bg-white/90 px-3 py-1 rounded shadow text-xs font-bold text-slate-600 z-[1000]">
                    <span class="inline-block w-3 h-3 rounded-full bg-green-500 opacity-50 mr-1 align-middle"></span>ì˜ì—­ íŒíŠ¸
                </div>
            </div>

            <div id="flag-container" class="w-full h-full hidden flex-col items-center justify-center p-4 bg-slate-50">
                <img id="flag-image" src="" alt="Flag" class="quiz-img border border-slate-200 object-contain">
            </div>

            <div id="landmark-container" class="w-full h-full hidden flex-col items-center justify-center p-2 bg-slate-100">
                <!-- JSì—ì„œ ì²˜ë¦¬í•˜ë¯€ë¡œ onerror ì œê±° -->
                <img id="landmark-image" src="" alt="Landmark" class="quiz-img w-full object-cover rounded-lg shadow-md">
                <div class="mt-2 text-xs text-slate-400 font-medium">AI Generated Landmark (Preview)</div>
            </div>

            <div id="text-quiz-container" class="w-full min-h-[250px] hidden flex flex-col items-center justify-center p-6 bg-gradient-to-br from-indigo-50 to-blue-50 text-center">
                <div class="text-6xl mb-4" id="quiz-icon">ğŸ‘œ</div>
                <div id="text-quiz-content" class="w-full"></div>
            </div>

            <!-- ë¡œë”© í™”ë©´ -->
            <div id="loading" class="absolute inset-0 bg-white/95 z-20 flex flex-col items-center justify-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-4 border-blue-600 mb-4"></div>
                <span class="text-blue-600 font-bold text-lg">ë‹¤ìŒ ì—¬í–‰ì§€ë¡œ ì´ë™ ì¤‘...</span>
                <p class="text-xs text-slate-400 mt-2">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</p>
                <button onclick="forceStopLoading()" class="mt-4 px-4 py-2 bg-slate-200 hover:bg-slate-300 rounded text-slate-600 text-xs font-bold">
                    ë©ˆì·„ë‚˜ìš”? ì—¬ê¸° í´ë¦­
                </button>
            </div>
        </div>

        <div id="options-container" class="grid grid-cols-2 gap-3 mt-2 min-h-[150px]"></div>

    </main>

    <!-- ë¹„ë””ì˜¤ ëª¨ë‹¬ -->
    <div id="video-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center">
        <div class="absolute inset-0 modal-overlay backdrop-blur-sm" onclick="closeModal()"></div>
        <div class="relative w-11/12 max-w-2xl bg-white rounded-xl shadow-2xl overflow-hidden border-4 border-white flex flex-col max-h-[90vh]">
            <div class="bg-blue-600 text-white p-3 flex justify-between items-center shrink-0">
                <h3 class="font-bold flex items-center gap-2">
                    <span>ğŸ‰ ì •ë‹µ! íˆ¬ì–´ë©”ì´ì»¤ ì¶”ì²œ ì—¬í–‰ì§€</span>
                </h3>
                <button onclick="closeModal()" class="hover:bg-blue-700 rounded-full p-1">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <div class="video-container bg-black shrink-0">
                <iframe id="reward-video" src="" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
            
            <div class="p-4 text-center bg-slate-50 flex flex-col gap-3 overflow-y-auto">
                <p class="text-slate-800 font-bold text-lg" id="modal-title">êµ­ê°€ ì´ë¦„</p>
                <p class="text-slate-600 text-sm whitespace-pre-wrap" id="modal-desc">ì„¤ëª…</p>
                
                <a id="video-fallback-link" href="#" target="_blank" class="block w-full py-2 bg-red-100 hover:bg-red-200 text-red-600 rounded-lg text-sm font-bold transition-colors">
                    ğŸ“º ì˜ìƒì´ ì•ˆ ë‚˜ì˜¤ë‚˜ìš”? ìœ íŠœë¸Œ ì•±ì—ì„œ ë³´ê¸° (í´ë¦­)
                </a>

                <button onclick="closeModal()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-lg transition-all transform hover:scale-105 mt-2">
                    ë‹¤ìŒ ë¬¸ì œ í’€ê¸° (Next Level) â¡
                </button>
            </div>
        </div>
    </div>

    <!-- í‘¸í„° -->
    <footer class="w-full bg-slate-800 text-slate-300 p-6 text-center mt-auto">
        <p class="font-bold text-lg mb-1">Tourmaker Smart Guide</p>
        <p class="text-sm opacity-75">Created by <span class="text-yellow-400 font-bold">Lee Sungbin (Sebastian)</span></p>
        <p class="text-xs mt-2 opacity-50">Since 2019 â€¢ Gangwon-do, Korea</p>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
        // ë‚œì´ë„ ìƒí–¥! ì „ë¬¸ê°€ìš© êµ­ê°€ ë°ì´í„° (Official Tourism Video IDs Updated)
        const countries = [
            // Hard Level Countries
            { name: "ê°€ë‚˜ (Ghana)", capital: "ì•„í¬ë¼ (Accra)", brands: ["Cocoa", "Gold", "Kente Cloth"], lat: 7.9, lng: -1.0, zoom: 6, radius: 250000, code: "gh", videoId: "wIE-CxkN5d0" },
            { name: "íŠ¸ë¦¬ë‹ˆë‹¤ë“œ í† ë°”ê³  (Trinidad & Tobago)", capital: "í¬íŠ¸ì˜¤ë¸ŒìŠ¤í˜ì¸ (Port of Spain)", brands: ["Angostura", "Carnival", "Steelpan"], lat: 10.6, lng: -61.2, zoom: 8, radius: 60000, code: "tt", videoId: "fOBg4Y9HxS4" },
            { name: "ë°”ë² ì´ë„ìŠ¤ (Barbados)", capital: "ë¸Œë¦¬ì§€íƒ€ìš´ (Bridgetown)", brands: ["Mount Gay Rum", "Rihanna", "Cricket"], lat: 13.1, lng: -59.5, zoom: 10, radius: 20000, code: "bb", videoId: "CiCqv6VWzHw" },
            { name: "íŒŒë‚˜ë§ˆ (Panama)", capital: "íŒŒë‚˜ë§ˆì‹œí‹° (Panama City)", brands: ["Panama Canal", "Copa Airlines"], lat: 8.9, lng: -79.5, zoom: 7, radius: 150000, code: "pa", videoId: "OnXI4-fCTcg" },
            { name: "ë³¼ë¦¬ë¹„ì•„ (Bolivia)", capital: "ë¼íŒŒìŠ¤ (La Paz)", brands: ["Uyuni Salt Flat", "Llama", "Coca Tea"], lat: -16.5, lng: -68.1, zoom: 5, radius: 800000, code: "bo", videoId: "nq8NJBJqZT0" },
            { name: "ë¯¸ì–€ë§ˆ (Myanmar)", capital: "ë„¤í”¼ë„ (Naypyidaw)", brands: ["Jade", "Ruby", "Bagan", "Teak"], lat: 19.7, lng: 96.1, zoom: 5, radius: 600000, code: "mm", videoId: "bpWbwMoYISk" },
            { name: "ë¸Œë£¨ë‚˜ì´ (Brunei)", capital: "ë°˜ë‹¤ë¥´ìŠ¤ë¦¬ë¸Œê°€ì™„ (Bandar Seri Begawan)", brands: ["Royal Brunei", "Oil & Gas"], lat: 4.9, lng: 114.9, zoom: 9, radius: 40000, code: "bn", videoId: "z2i8f2wTD8k" }, // Updated Video
            
            // European & Others
            { name: "ë…ì¼ (Germany)", capital: "ë² ë¥¼ë¦° (Berlin)", brands: ["BMW", "Adidas", "Mercedes-Benz"], lat: 51.1, lng: 10.4, zoom: 6, radius: 350000, code: "de", videoId: "8DEozJok3U8" }, // Updated Video
            { name: "ëª¨ë¡œì½” (Morocco)", capital: "ë¼ë°”íŠ¸ (Rabat)", brands: ["Argan Oil", "Couscous"], lat: 31.7, lng: -7.0, zoom: 5, radius: 500000, code: "ma", videoId: "q1-2-3-4" },
            { name: "ëª½ê³¨ (Mongolia)", capital: "ìš¸ë€ë°”í† ë¥´ (Ulaanbaatar)", brands: ["Gobi Cashmere", "Ger"], lat: 46.8, lng: 103.8, zoom: 5, radius: 800000, code: "mn", videoId: "m_n3g5_wE_w" },
            { name: "ì—ìŠ¤í† ë‹ˆì•„ (Estonia)", capital: "íƒˆë¦° (Tallinn)", brands: ["Skype", "Bolt", "e-Residency"], lat: 59.4, lng: 24.7, zoom: 7, radius: 100000, code: "ee", videoId: "7O1pE-s-5-E" },
            { name: "ì¹ ë ˆ (Chile)", capital: "ì‚°í‹°ì•„ê³  (Santiago)", brands: ["LATAM Airlines", "Wine"], lat: -35.6, lng: -71.5, zoom: 4, radius: 1500000, code: "cl", videoId: "3e3hXgWj_wE" },
            { name: "í¬ë¥´íˆ¬ê°ˆ (Portugal)", capital: "ë¦¬ìŠ¤ë³¸ (Lisbon)", brands: ["TAP Air", "Cork"], lat: 39.3, lng: -8.2, zoom: 7, radius: 200000, code: "pt", videoId: "p_w3g5_wE_w" },
            { name: "ë‰´ì§ˆëœë“œ (New Zealand)", capital: "ì›°ë§í„´ (Wellington)", brands: ["Zespri", "Air New Zealand"], lat: -40.9, lng: 174.8, zoom: 5, radius: 500000, code: "nz", videoId: "ty1_jSj_g_k" },
            { name: "ì´ì§‘íŠ¸ (Egypt)", capital: "ì¹´ì´ë¡œ (Cairo)", brands: ["EgyptAir", "Cotton"], lat: 26.8, lng: 30.8, zoom: 6, radius: 500000, code: "eg", videoId: "t3Ww0r_wE_w" },
            { name: "íŠ€ë¥´í‚¤ì˜ˆ (Turkey)", capital: "ì•™ì¹´ë¼ (Ankara)", brands: ["Turkish Airlines", "Beko"], lat: 38.9, lng: 35.2, zoom: 6, radius: 600000, code: "tr", videoId: "l8yT0yW6f_M" },
            { name: "ëŒ€í•œë¯¼êµ­ (South Korea)", capital: "ì„œìš¸ (Seoul)", brands: ["Samsung", "Hyundai", "BTS"], lat: 36.5, lng: 127.8, zoom: 6, radius: 250000, code: "kr", videoId: "3P1CnWI62Ik" },
            { name: "ì¼ë³¸ (Japan)", capital: "ë„ì¿„ (Tokyo)", brands: ["Sony", "Nintendo"], lat: 36.2, lng: 138.2, zoom: 5, radius: 600000, code: "jp", videoId: "xKkL4c77O14" },
            { name: "ë¯¸êµ­ (USA)", capital: "ì›Œì‹±í„´ D.C. (Washington D.C.)", brands: ["Apple", "Coca-Cola"], lat: 39.8, lng: -98.5, zoom: 4, radius: 2500000, code: "us", videoId: "h1F7hRz5t3A" }
        ];

        let map;
        let mapCircle;
        let currentRound = 0;
        let score = 0;
        let currentCountry = null;
        let currentType = ''; 
        let isAnswered = false;
        let safeTimer = null;
        
        let prevCountryIndex = null;
        let prevType = null;

        function initMap() {
            try {
                map = L.map('map', {
                    zoomControl: true, attributionControl: false,
                    dragging: true, scrollWheelZoom: true, doubleClickZoom: true
                }).setView([20, 0], 2); 

                L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    attribution: 'Tiles &copy; Esri', maxZoom: 17
                }).addTo(map);

                startGame();
            } catch (error) {
                console.error("Map initialization failed:", error);
                document.getElementById('question-title').textContent = "ì˜¤ë¥˜ ë°œìƒ";
                document.getElementById('question-desc').textContent = "ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.";
            }
        }

        function startGame() {
            nextRound();
        }

        // [í•µì‹¬] ì•ˆì „í•œ ë¡œë”© ì¢…ë£Œ
        function forceStopLoading() {
            const loader = document.getElementById('loading');
            if (loader && !loader.classList.contains('hidden')) {
                loader.classList.add('hidden');
                console.log("Loading forced to stop.");
            }
        }

        // [ê°œì„ ] ëœë“œë§ˆí¬ ì‹¤íŒ¨ ì‹œ ê¹”ë”í•œ ì „í™˜
        function handleImageError() {
            console.warn("Landmark image failed, falling back to flag quiz");
            currentType = 'flag';
            updateDisplayForRound(); 
            // forceStopLoading í˜¸ì¶œ ë¶ˆí•„ìš”: flag ëª¨ë“œì—ì„œ ì´ë¯¸ì§€ ë¡œë“œ í›„ í•´ì œí•¨
        }

        function nextRound() {
            if (safeTimer) clearTimeout(safeTimer);
            document.getElementById('loading').classList.remove('hidden');
            safeTimer = setTimeout(forceStopLoading, 3000); 

            const modal = document.getElementById('video-modal');
            const iframe = document.getElementById('reward-video');
            if(iframe) iframe.src = ""; 
            if(modal) modal.classList.add('hidden');

            isAnswered = false;
            currentRound++;
            document.getElementById('level-display').textContent = currentRound;
            
            const container = document.getElementById('options-container');
            if(container) {
                container.innerHTML = '';
                container.classList.remove('opacity-50', 'pointer-events-none');
            }
            
            if (mapCircle) {
                map.removeLayer(mapCircle);
                mapCircle = null;
            }
            
            const types = ['map', 'flag', 'landmark', 'brand'];
            let newType;
            do {
                newType = types[Math.floor(Math.random() * types.length)];
            } while (types.length > 1 && newType === prevType);
            currentType = newType;
            prevType = newType;
            
            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * countries.length);
            } while (countries.length > 1 && randomIndex === prevCountryIndex);
            
            prevCountryIndex = randomIndex;
            currentCountry = countries[randomIndex];

            try {
                updateDisplayForRound();
            } catch (error) {
                currentType = 'flag';
                updateDisplayForRound();
            }

            createOptions();

            // [ìµœí›„ ë°©ì–´] í˜¹ì‹œë¼ë„ 3ì´ˆ íƒ€ì´ë¨¸ê°€ ì”¹íˆê±°ë‚˜ ë¡œì§ì´ ê¼¬ì—¬ë„ 4ì´ˆ ë’¤ì—” ë¬´ì¡°ê±´ í’ˆ
            setTimeout(() => {
                forceStopLoading();
            }, 4000);
        }

        function updateDisplayForRound() {
            const titleEl = document.getElementById('question-title');
            const descEl = document.getElementById('question-desc');
            const badgeEl = document.getElementById('quiz-type-badge');
            
            const mapContainer = document.getElementById('map-container');
            const flagContainer = document.getElementById('flag-container');
            const landmarkContainer = document.getElementById('landmark-container'); 
            const textContainer = document.getElementById('text-quiz-container');
            
            const textContent = document.getElementById('text-quiz-content');
            const flagImg = document.getElementById('flag-image');
            const landmarkImg = document.getElementById('landmark-image'); 
            const quizIcon = document.getElementById('quiz-icon');

            mapContainer.classList.add('hidden');
            flagContainer.classList.add('hidden');
            landmarkContainer.classList.add('hidden'); 
            textContainer.classList.add('hidden');

            const safeName = currentCountry.name || "Unknown";
            const safeCapital = currentCountry.capital || "Unknown";
            
            const capitalKo = safeCapital.includes('(') ? safeCapital.split('(')[0] : safeCapital;
            const capitalEn = safeCapital.includes('(') ? safeCapital.split('(')[1].replace(')', '') : safeCapital;
            const countryEn = safeName.includes('(') ? safeName.split('(')[1].replace(')', '') : 'Country';
            const safeBrands = currentCountry.brands || [];

            if (currentType === 'map') {
                badgeEl.textContent = "ì§€ë„ í€´ì¦ˆ (ë‚œì´ë„ ìƒ)";
                badgeEl.className = "inline-block px-3 py-1 rounded-full text-xs font-bold text-white bg-green-600 mb-2";
                titleEl.textContent = "ğŸŒ ì´ ë‚˜ë¼ëŠ” ì–´ë””ì¼ê¹Œìš”?";
                descEl.textContent = "ì´ˆë¡ìƒ‰ ì˜ì—­ì„ ë³´ê³  ë‚˜ë¼ë¥¼ ë§ì¶°ë³´ì„¸ìš”!";
                mapContainer.classList.remove('hidden');
                
                setTimeout(() => {
                    map.invalidateSize();
                    map.flyTo([currentCountry.lat, currentCountry.lng], currentCountry.zoom, { duration: 1.0 });
                    
                    mapCircle = L.circle([currentCountry.lat, currentCountry.lng], {
                        color: '#22c55e', fillColor: '#22c55e', fillOpacity: 0.2, radius: currentCountry.radius 
                    }).addTo(map);
                    forceStopLoading();
                }, 800);
            
            } else if (currentType === 'flag') {
                badgeEl.textContent = "êµ­ê¸° í€´ì¦ˆ";
                badgeEl.className = "inline-block px-3 py-1 rounded-full text-xs font-bold text-white bg-red-500 mb-2";
                titleEl.textContent = "ğŸ³ï¸ ì´ êµ­ê¸°ëŠ” ì–´ëŠ ë‚˜ë¼ì¼ê¹Œìš”?";
                descEl.textContent = "êµ­ê¸°ë¥¼ ë³´ê³  ì •ë‹µì„ ë§ì¶°ë³´ì„¸ìš”!";
                flagContainer.classList.remove('hidden');
                flagImg.src = `https://flagcdn.com/h240/${currentCountry.code}.png`;
                flagImg.onload = forceStopLoading; 
                
            } else if (currentType === 'landmark') { 
                badgeEl.textContent = "ëœë“œë§ˆí¬ í€´ì¦ˆ";
                badgeEl.className = "inline-block px-3 py-1 rounded-full text-xs font-bold text-white bg-purple-600 mb-2";
                titleEl.textContent = "ğŸ“¸ ì´ ë©‹ì§„ ê³³ì€ ì–´ë””ì¼ê¹Œìš”?";
                descEl.textContent = `íŒíŠ¸: ${capitalEn}ì˜ í’ê²½ì…ë‹ˆë‹¤.`;
                
                landmarkContainer.classList.remove('hidden');
                
                const prompt = `famous landmark architecture of ${capitalEn} ${countryEn}, bright sunny day, 4k travel photography, realistic`;
                const imageUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?width=800&height=600&nologo=true&seed=${Math.random()}&model=flux`;
                
                // JSì—ì„œ ì—ëŸ¬ í•¸ë“¤ëŸ¬ ì—°ê²°
                landmarkImg.onerror = handleImageError;
                landmarkImg.src = imageUrl;
                landmarkImg.onload = forceStopLoading; 
            
            } else if (currentType === 'brand') {
                badgeEl.textContent = "í‚¤ì›Œë“œ í€´ì¦ˆ";
                badgeEl.className = "inline-block px-3 py-1 rounded-full text-xs font-bold text-white bg-orange-500 mb-2";
                titleEl.textContent = "ğŸ‘œ ìœ ëª… í‚¤ì›Œë“œì˜ ê³ í–¥ì€?";
                descEl.textContent = "ì´ ë¸Œëœë“œë‚˜ í‚¤ì›Œë“œëŠ” ì–´ëŠ ë‚˜ë¼ ê²ƒì¼ê¹Œìš”?";
                textContainer.classList.remove('hidden');
                quizIcon.textContent = "ğŸ”‘";
                
                const brandList = safeBrands.map(b => `<div class="brand-card">${b}</div>`).join('');
                textContent.innerHTML = `<div class="flex flex-wrap justify-center items-center">${brandList}</div>`;
                forceStopLoading();
            }
        }

        function createOptions() {
            try {
                let options = [currentCountry];
                const otherCountries = countries.filter(c => c.name !== currentCountry.name);
                const shuffledOthers = otherCountries.sort(() => 0.5 - Math.random()).slice(0, 3);
                options = options.concat(shuffledOthers);
                options.sort(() => 0.5 - Math.random());

                const container = document.getElementById('options-container');
                options.forEach(option => {
                    const btn = document.createElement('button');
                    btn.className = "option-btn bg-white hover:bg-slate-50 border-2 border-slate-200 text-slate-700 font-semibold py-4 px-2 rounded-lg shadow-sm transition-all active:scale-95 text-sm sm:text-base break-keep";
                    
                    const btnText = option.name.includes('(') ? option.name.split('(')[0] : option.name;
                    btn.textContent = btnText;
                    
                    btn.onclick = () => checkAnswer(option, btn);
                    container.appendChild(btn);
                });
            } catch (error) {
                console.error("Error creating options:", error);
            }
        }

        function checkAnswer(selected, btnElement) {
            if (isAnswered) return;
            isAnswered = true;
            const container = document.getElementById('options-container');

            if (selected.name === currentCountry.name) {
                score += 10;
                document.getElementById('score').textContent = score;
                btnElement.classList.add('bg-green-100', 'border-green-500', 'text-green-700', 'correct-anim');
                
                setTimeout(() => {
                    openModal(currentCountry);
                }, 500); 

            } else {
                btnElement.classList.add('bg-red-100', 'border-red-500', 'text-red-700');
                
                const buttons = container.getElementsByTagName('button');
                const correctName = currentCountry.name.includes('(') ? currentCountry.name.split('(')[0] : currentCountry.name;
                
                for (let btn of buttons) {
                    if (btn.textContent === correctName) {
                        btn.classList.add('bg-green-100', 'border-green-500', 'text-green-700');
                    }
                }
                setTimeout(() => {
                    nextRound();
                }, 2000);
            }
            container.classList.add('pointer-events-none');
        }

        // [ê°œì„ ] ëª¨ë‹¬ í‘œì‹œ ë¡œì§ ì •ë¦¬
        function openModal(country) {
            const modal = document.getElementById('video-modal');
            const iframe = document.getElementById('reward-video');
            const title = document.getElementById('modal-title');
            const desc = document.getElementById('modal-desc');
            const fallbackLink = document.getElementById('video-fallback-link');

            const countryKo = country.name.split('(')[0].trim();
            const countryEn = country.name.includes('(') ? country.name.split('(')[1].replace(')', '').trim() : '';
            const capitalKo = country.capital.split('(')[0].trim();

            title.textContent = `${countryKo} ì—¬í–‰ì„ ë– ë‚˜ë³¼ê¹Œìš”?`;

            let videoId = country.videoId;
            const isPlaceholder = !videoId || videoId.includes('1-2-3');

            // í…ìŠ¤íŠ¸ ì„¤ì •
            if (isPlaceholder) {
                videoId = "P_upO4tqLTk"; // ê¸°ë³¸ ì˜ìƒ
                desc.textContent = `ìˆ˜ë„: ${capitalKo}\nì•„ì§ ì „ìš© í™ë³´ ì˜ìƒì´ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œì—ì„œ ì§ì ‘ ê²€ìƒ‰í•´ë³´ì„¸ìš”!`;
            } else {
                desc.textContent = `ìˆ˜ë„: ${capitalKo}\níˆ¬ì–´ë©”ì´ì»¤ê°€ ì—„ì„ í•œ í˜„ì§€ í™ë³´ ì˜ìƒì…ë‹ˆë‹¤.`;
            }

            // ì˜ìƒ ë¡œë“œ
            iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&rel=0&showinfo=0&modestbranding=1`;
            
            // ë§í¬ ì„¤ì •
            if (fallbackLink) {
                if (!isPlaceholder) {
                     fallbackLink.href = `https://www.youtube.com/watch?v=${videoId}`;
                     fallbackLink.textContent = "ğŸ“º ì˜ìƒì´ ì•ˆ ë‚˜ì˜¤ë‚˜ìš”? ìœ íŠœë¸Œ ì•±ì—ì„œ ë³´ê¸° (í´ë¦­)";
                } else {
                     const query = countryEn || countryKo;
                     fallbackLink.href = `https://www.youtube.com/results?search_query=travel+${encodeURIComponent(query)}`;
                     fallbackLink.textContent = "ğŸ“º ë” ë§ì€ ì˜ìƒ ê²€ìƒ‰í•˜ê¸° (ìœ íŠœë¸Œ ì´ë™)";
                }
            }

            modal.classList.remove('hidden');
        }

        function closeModal() {
            const modal = document.getElementById('video-modal');
            const iframe = document.getElementById('reward-video');
            iframe.src = ""; 
            modal.classList.add('hidden');
            
            if(isAnswered) {
                 nextRound();
            }
        }

        window.onload = initMap;
    </script>
</body>
</html>
