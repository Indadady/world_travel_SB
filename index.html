<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íˆ¬ì–´ë©”ì´ì»¤ - ì„¸ê³„ ì—¬í–‰ ë§ˆìŠ¤í„° (By Sebastian)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&family=Roboto+Slab:wght@700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        #map { height: 350px; width: 100%; border-radius: 0.5rem; z-index: 1; }
        .flag-img { height: 250px; width: auto; max-width: 100%; object-fit: contain; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .correct-anim { animation: bounce 0.5s; }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal-overlay { background-color: rgba(0, 0, 0, 0.7); }
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        
        /* ë³´ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .option-btn {
            min-height: 60px;
        }

        /* ë¸Œëœë“œ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .brand-card {
            font-family: 'Roboto Slab', serif; /* ë¡œê³  ê°™ì€ í°íŠ¸ */
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            color: #343a40;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 1rem 1.5rem;
            margin: 0.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            font-size: 1.25rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: transform 0.2s;
        }
        .brand-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen flex flex-col items-center">

    <!-- í—¤ë” -->
    <header class="w-full bg-white shadow-md p-4 flex justify-between items-center sticky top-0 z-50">
        <div class="flex items-center gap-3">
            <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgHfgIX70O5k6Anuo0UgALIdaG9jSga9auHu3uyz0uEirylGPAJnjN_qQbvEGMUvPqUQf_g9FMNUHRxlDcUBf4vZ3Mpy4TnA9WxbmzWYK11gt2zuy_Irl4wctNFjcjLyPo0GPXV792o_J7L9guRMuDfeC1gy7USwywjYbECZgzcsHybuGRRAXAnO1eNmP8/s320/logo.png" 
                 alt="Tourmaker Logo" class="h-10 w-auto object-contain">
            <h1 class="text-xl font-bold text-slate-800 hidden sm:block">World Travel Master</h1>
        </div>
        <div class="flex items-center gap-4">
            <div class="text-slate-600 font-medium">
                LV.<span id="level-display" class="font-bold text-slate-800">1</span>
            </div>
            <div class="text-slate-600 font-medium">
                Score: <span id="score" class="text-blue-600 font-bold text-lg">0</span>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ê²Œì„ ì˜ì—­ -->
    <main class="w-full max-w-2xl p-4 flex-grow flex flex-col gap-4">
        
        <!-- ë¬¸ì œ ì„¤ëª… -->
        <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200 text-center">
            <span id="quiz-type-badge" class="inline-block px-3 py-1 rounded-full text-xs font-bold text-white bg-blue-500 mb-2">Quiz</span>
            <h2 id="question-title" class="text-xl font-black text-slate-800 mb-1">ì—¬í–‰ ì¤€ë¹„ ì¤‘...</h2>
            <p id="question-desc" class="text-sm text-slate-500">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
        </div>

        <!-- ì‹œê° ìë£Œ ì˜ì—­ -->
        <div class="bg-white p-2 rounded-lg shadow-lg border border-slate-300 relative min-h-[250px] flex items-center justify-center overflow-hidden">
            
            <!-- 1. ì§€ë„ ì»¨í…Œì´ë„ˆ -->
            <div id="map-container" class="w-full h-full hidden">
                <div id="map"></div>
                <!-- ì§€ë„ íŒíŠ¸ ë²”ë¡€ -->
                <div class="absolute bottom-4 right-4 bg-white/90 px-3 py-1 rounded shadow text-xs font-bold text-slate-600 z-[1000]">
                    <span class="inline-block w-3 h-3 rounded-full bg-green-500 opacity-50 mr-1 align-middle"></span>ì˜ì—­ íŒíŠ¸
                </div>
            </div>

            <!-- 2. êµ­ê¸° ì»¨í…Œì´ë„ˆ -->
            <div id="flag-container" class="w-full h-full hidden flex-col items-center justify-center p-4 bg-slate-50">
                <img id="flag-image" src="" alt="Flag" class="flag-img border border-slate-200">
            </div>

            <!-- 3. í…ìŠ¤íŠ¸ í€´ì¦ˆ ì»¨í…Œì´ë„ˆ (ìˆ˜ë„/ë¸Œëœë“œ) -->
            <div id="text-quiz-container" class="w-full min-h-[250px] hidden flex flex-col items-center justify-center p-6 bg-gradient-to-br from-indigo-50 to-blue-50 text-center">
                <div class="text-6xl mb-4" id="quiz-icon">ğŸ™ï¸</div>
                <div id="text-quiz-content" class="w-full">
                    <!-- ë¬¸ì œ í…ìŠ¤íŠ¸ -->
                </div>
            </div>

            <!-- ë¡œë”© -->
            <div id="loading" class="absolute inset-0 bg-white/95 z-20 flex flex-col items-center justify-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-4 border-blue-600 mb-4"></div>
                <span class="text-blue-600 font-bold text-lg">ë‹¤ìŒ ì—¬í–‰ì§€ë¡œ ì´ë™ ì¤‘...</span>
            </div>
        </div>

        <!-- ì •ë‹µ ì„ íƒì§€ -->
        <div id="options-container" class="grid grid-cols-2 gap-3 mt-2 min-h-[150px]">
            <!-- ë²„íŠ¼ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>

    </main>

    <!-- ë¹„ë””ì˜¤ ëª¨ë‹¬ (ì •ë‹µ ì‹œ íŒì—…) -->
    <div id="video-modal" class="fixed inset-0 z-[100] hidden">
        <div class="absolute inset-0 modal-overlay backdrop-blur-sm" onclick="closeModal()"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-11/12 max-w-2xl bg-white rounded-xl shadow-2xl overflow-hidden border-4 border-white">
            <div class="bg-blue-600 text-white p-3 flex justify-between items-center">
                <h3 class="font-bold flex items-center gap-2">
                    <span>ğŸ‰ ì •ë‹µ! ì—¬í–‰ì„ ë– ë‚˜ë³¼ê¹Œìš”?</span>
                </h3>
                <button onclick="closeModal()" class="hover:bg-blue-700 rounded-full p-1">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <div class="video-container bg-black">
                <iframe id="reward-video" src="" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
            
            <div class="p-4 text-center bg-slate-50">
                <p class="text-slate-700 font-medium mb-3" id="modal-desc">ì ì‹œ í›„ ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                <button onclick="closeModal()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-lg transition-all transform hover:scale-105">
                    ë‹¤ìŒ ë¬¸ì œ í’€ê¸° (Next Level) â¡
                </button>
            </div>
        </div>
    </div>

    <!-- í‘¸í„° -->
    <footer class="w-full bg-slate-800 text-slate-300 p-6 text-center mt-auto">
        <p class="font-bold text-lg mb-1">Tourmaker Smart Guide</p>
        <p class="text-sm opacity-75">Created by <span class="text-yellow-400 font-bold">Lee Sungbin (Sebastian)</span></p>
        <p class="text-xs mt-2 opacity-50">Since 2019 â€¢ Gangwon-do, Korea</p>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
        // ë‚˜ë¼ ë°ì´í„°: radius(km ë‹¨ìœ„ ë°˜ì§€ë¦„, ì§€ë„ í‘œì‹œìš©) ì¶”ê°€
        const countries = [
            // ì•„ì‹œì•„
            { name: "ëŒ€í•œë¯¼êµ­ (South Korea)", capital: "ì„œìš¸ (Seoul)", brands: ["Samsung", "Hyundai", "KIA", "LG"], lat: 36.5, lng: 127.8, zoom: 6, radius: 250000, code: "kr", videoId: "3P1CnWI62Ik" }, 
            { name: "ì¼ë³¸ (Japan)", capital: "ë„ì¿„ (Tokyo)", brands: ["Sony", "Toyota", "Nintendo", "Uniqlo"], lat: 36.2, lng: 138.2, zoom: 5, radius: 600000, code: "jp", videoId: "xKkL4c77O14" },
            { name: "ì¤‘êµ­ (China)", capital: "ë² ì´ì§• (Beijing)", brands: ["Xiaomi", "Haier", "TikTok"], lat: 35.8, lng: 104.1, zoom: 4, radius: 2000000, code: "cn", videoId: "1rV6bTwtTDU" },
            { name: "ë² íŠ¸ë‚¨ (Vietnam)", capital: "í•˜ë…¸ì´ (Hanoi)", brands: ["VinFast", "G7 Coffee", "Vietnam Airlines"], lat: 14.0, lng: 108.2, zoom: 5, radius: 400000, code: "vn", videoId: "MXKVwb9YFfE" },
            { name: "íƒœêµ­ (Thailand)", capital: "ë°©ì½• (Bangkok)", brands: ["Red Bull", "Singha", "Chang"], lat: 15.8, lng: 100.9, zoom: 5, radius: 450000, code: "th", videoId: "P_upO4tqLTk" },
            { name: "ì¸ë„ (India)", capital: "ë‰´ë¸ë¦¬ (New Delhi)", brands: ["Tata", "Mahindra", "Himalaya"], lat: 20.5, lng: 78.9, zoom: 5, radius: 1200000, code: "in", videoId: "IgFjjcXTbJM" },
            { name: "ì¸ë„ë„¤ì‹œì•„ (Indonesia)", capital: "ìì¹´ë¥´íƒ€ (Jakarta)", brands: ["Indomie", "Kopiko"], lat: -0.7, lng: 113.9, zoom: 5, radius: 1500000, code: "id", videoId: "hZ7a_t5gJbE" },
            { name: "ì‹±ê°€í¬ë¥´ (Singapore)", capital: "ì‹±ê°€í¬ë¥´ (Singapore)", brands: ["Singapore Airlines", "Tiger Beer"], lat: 1.35, lng: 103.8, zoom: 10, radius: 25000, code: "sg", videoId: "P_q3BdrFsLI" },
            { name: "ì‚¬ìš°ë””ì•„ë¼ë¹„ì•„ (Saudi Arabia)", capital: "ë¦¬ì•¼ë“œ (Riyadh)", brands: ["Aramco", "Al Baik"], lat: 23.8, lng: 45.0, zoom: 5, radius: 900000, code: "sa", videoId: "Z42C8p41F5o" }, 
            
            // ìœ ëŸ½
            { name: "í”„ë‘ìŠ¤ (France)", capital: "íŒŒë¦¬ (Paris)", brands: ["Louis Vuitton", "Chanel", "Renault"], lat: 46.2, lng: 2.2, zoom: 6, radius: 450000, code: "fr", videoId: "u_p635J9tKs" },
            { name: "ì˜êµ­ (UK)", capital: "ëŸ°ë˜ (London)", brands: ["Burberry", "Dyson", "Rolls-Royce"], lat: 54.5, lng: -3.4, zoom: 5, radius: 400000, code: "gb", videoId: "iO_8G85gq4M" },
            { name: "ì´íƒˆë¦¬ì•„ (Italy)", capital: "ë¡œë§ˆ (Rome)", brands: ["Gucci", "Ferrari", "Prada"], lat: 41.8, lng: 12.5, zoom: 6, radius: 400000, code: "it", videoId: "2b9txcAt4e0" },
            { name: "ë…ì¼ (Germany)", capital: "ë² ë¥¼ë¦° (Berlin)", brands: ["BMW", "Adidas", "Mercedes-Benz"], lat: 51.1, lng: 10.4, zoom: 6, radius: 350000, code: "de", videoId: "NMzJ7bFpIeQ" },
            { name: "ìŠ¤í˜ì¸ (Spain)", capital: "ë§ˆë“œë¦¬ë“œ (Madrid)", brands: ["Zara", "Chupa Chups", "Balenciaga"], lat: 40.4, lng: -3.7, zoom: 6, radius: 400000, code: "es", videoId: "I_c3Jg6X8W8" },
            { name: "ìŠ¤ìœ„ìŠ¤ (Switzerland)", capital: "ë² ë¥¸ (Bern)", brands: ["Rolex", "NestlÃ©", "Lindt"], lat: 46.8, lng: 8.2, zoom: 7, radius: 120000, code: "ch", videoId: "linlz7-Pnvw" },
            { name: "ë„¤ëœë€ë“œ (Netherlands)", capital: "ì•”ìŠ¤í…Œë¥´ë‹´ (Amsterdam)", brands: ["Philips", "Heineken", "Shell"], lat: 52.1, lng: 5.2, zoom: 7, radius: 100000, code: "nl", videoId: "zXl9z3Z2wT4" },
            { name: "ìŠ¤ì›¨ë´ (Sweden)", capital: "ìŠ¤í†¡í™€ë¦„ (Stockholm)", brands: ["IKEA", "Volvo", "H&M"], lat: 60.1, lng: 18.6, zoom: 5, radius: 500000, code: "se", videoId: "o5oX2vF-5sE" },
            
            // ë¶ë¯¸/ë‚¨ë¯¸
            { name: "ë¯¸êµ­ (USA)", capital: "ì›Œì‹±í„´ D.C. (Washington D.C.)", brands: ["Apple", "Coca-Cola", "Disney"], lat: 39.8, lng: -98.5, zoom: 4, radius: 2500000, code: "us", videoId: "h1F7hRz5t3A" }, 
            { name: "ìºë‚˜ë‹¤ (Canada)", capital: "ì˜¤íƒ€ì™€ (Ottawa)", brands: ["Canada Goose", "Tim Hortons"], lat: 56.1, lng: -106.3, zoom: 3, radius: 3000000, code: "ca", videoId: "m1YOS3tK_wE" },
            { name: "ë©•ì‹œì½” (Mexico)", capital: "ë©•ì‹œì½”ì‹œí‹° (Mexico City)", brands: ["Corona", "Aeromexico"], lat: 23.6, lng: -102.5, zoom: 5, radius: 1000000, code: "mx", videoId: "wM6eD8j6y_A" },
            { name: "ë¸Œë¼ì§ˆ (Brazil)", capital: "ë¸Œë¼ì§ˆë¦¬ì•„ (Brasilia)", brands: ["Havaianas", "Embraer"], lat: -14.2, lng: -51.9, zoom: 4, radius: 2000000, code: "br", videoId: "Qp0j4sz6gg8" },
            { name: "ì•„ë¥´í—¨í‹°ë‚˜ (Argentina)", capital: "ë¶€ì—ë…¸ìŠ¤ì•„ì´ë ˆìŠ¤ (Buenos Aires)", brands: ["Mercado Libre"], lat: -38.4, lng: -63.6, zoom: 4, radius: 1200000, code: "ar", videoId: "fP-wO_Y1z_g" },
            { name: "ì¹ ë ˆ (Chile)", capital: "ì‚°í‹°ì•„ê³  (Santiago)", brands: ["LATAM Airlines", "Concha y Toro"], lat: -35.6, lng: -71.5, zoom: 4, radius: 1500000, code: "cl", videoId: "3e3hXgWj_wE" },
            
            // ì˜¤ì„¸ì•„ë‹ˆì•„/ê¸°íƒ€
            { name: "í˜¸ì£¼ (Australia)", capital: "ìº”ë²„ë¼ (Canberra)", brands: ["Qantas", "UGG", "Billabong"], lat: -25.2, lng: 133.7, zoom: 4, radius: 2000000, code: "au", videoId: "f0pY0p4Z5tU" },
            { name: "ë‰´ì§ˆëœë“œ (New Zealand)", capital: "ì›°ë§í„´ (Wellington)", brands: ["Zespri (Kiwi)", "Air New Zealand"], lat: -40.9, lng: 174.8, zoom: 5, radius: 500000, code: "nz", videoId: "ty1_jSj_g_k" },
            { name: "íŠ€ë¥´í‚¤ì˜ˆ (Turkey)", capital: "ì•™ì¹´ë¼ (Ankara)", brands: ["Turkish Airlines", "Beko"], lat: 38.9, lng: 35.2, zoom: 6, radius: 600000, code: "tr", videoId: "l8yT0yW6f_M" }, 
            { name: "ì´ì§‘íŠ¸ (Egypt)", capital: "ì¹´ì´ë¡œ (Cairo)", brands: ["EgyptAir"], lat: 26.8, lng: 30.8, zoom: 6, radius: 500000, code: "eg", videoId: "t3Ww0r_wE_w" },
            { name: "ë‚¨ì•„ê³µ (South Africa)", capital: "í”„ë¦¬í† ë¦¬ì•„ (Pretoria)", brands: ["Nando's", "MTN"], lat: -30.5, lng: 22.9, zoom: 5, radius: 700000, code: "za", videoId: "V_w3g5_wE_w" },
            
             // ì¶”ê°€ êµ­ê°€
            { name: "ì•„ì¼ëœë“œ (Ireland)", capital: "ë”ë¸”ë¦° (Dublin)", brands: ["Guinness", "Ryanair"], lat: 53.1, lng: -7.6, zoom: 6, radius: 150000, code: "ie", videoId: "d_w3g5_wE_w" },
            { name: "ë²¨ê¸°ì— (Belgium)", capital: "ë¸Œë¤¼ì…€ (Brussels)", brands: ["Godiva", "Stella Artois"], lat: 50.8, lng: 4.3, zoom: 7, radius: 100000, code: "be", videoId: "b_w3g5_wE_w" },
            { name: "ì˜¤ìŠ¤íŠ¸ë¦¬ì•„ (Austria)", capital: "ë¹ˆ (Vienna)", brands: ["Red Bull", "Swarovski"], lat: 47.5, lng: 14.5, zoom: 7, radius: 200000, code: "at", videoId: "a_w3g5_wE_w" },
            { name: "ëŒ€ë§Œ (Taiwan)", capital: "íƒ€ì´ë² ì´ (Taipei)", brands: ["ASUS", "Acer", "Giant"], lat: 23.6, lng: 120.9, zoom: 7, radius: 150000, code: "tw", videoId: "t_w3g5_wE_w" },
            { name: "í™ì½© (Hong Kong)", capital: "í™ì½© (Hong Kong)", brands: ["Cathay Pacific", "Watsons"], lat: 22.3, lng: 114.1, zoom: 10, radius: 20000, code: "hk", videoId: "h_w3g5_wE_w" },
            { name: "í¬ë¥´íˆ¬ê°ˆ (Portugal)", capital: "ë¦¬ìŠ¤ë³¸ (Lisbon)", brands: ["TAP Air Portugal"], lat: 39.3, lng: -8.2, zoom: 7, radius: 200000, code: "pt", videoId: "p_w3g5_wE_w" },
            { name: "ë§ë ˆì´ì‹œì•„ (Malaysia)", capital: "ì¿ ì•Œë¼ë£¸í‘¸ë¥´ (KL)", brands: ["AirAsia", "Petronas"], lat: 4.2, lng: 101.9, zoom: 6, radius: 300000, code: "my", videoId: "m_w3g5_wE_w" },
            { name: "í•„ë¦¬í•€ (Philippines)", capital: "ë§ˆë‹ë¼ (Manila)", brands: ["San Miguel", "Jollibee"], lat: 12.8, lng: 121.7, zoom: 5, radius: 400000, code: "ph", videoId: "p_h3g5_wE_w" },
            { name: "ëª½ê³¨ (Mongolia)", capital: "ìš¸ë€ë°”í† ë¥´ (Ulaanbaatar)", brands: ["Gobi Cashmere"], lat: 46.8, lng: 103.8, zoom: 5, radius: 800000, code: "mn", videoId: "m_n3g5_wE_w" },
            { name: "í´ë€ë“œ (Poland)", capital: "ë°”ë¥´ìƒ¤ë°” (Warsaw)", brands: ["CD Projekt"], lat: 51.9, lng: 19.1, zoom: 6, radius: 300000, code: "pl", videoId: "p_l3g5_wE_w" },
            { name: "ì²´ì½” (Czechia)", capital: "í”„ë¼í•˜ (Prague)", brands: ["Å koda", "Pilsner Urquell"], lat: 49.8, lng: 15.4, zoom: 7, radius: 150000, code: "cz", videoId: "c_z3g5_wE_w" },
            { name: "ë…¸ë¥´ì›¨ì´ (Norway)", capital: "ì˜¤ìŠ¬ë¡œ (Oslo)", brands: ["Helly Hansen", "Norwegian Air"], lat: 60.4, lng: 8.4, zoom: 5, radius: 500000, code: "no", videoId: "n_o3g5_wE_w" }
        ];

        let map;
        let mapCircle; // ì§€ë„ì— í‘œì‹œí•  ì›
        let currentRound = 0;
        let score = 0;
        let currentCountry = null;
        let currentType = ''; 
        let isAnswered = false;

        function initMap() {
            try {
                map = L.map('map', {
                    zoomControl: true, attributionControl: false,
                    dragging: true, scrollWheelZoom: true, doubleClickZoom: true
                }).setView([36.5, 127.8], 6);

                L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    attribution: 'Tiles &copy; Esri', maxZoom: 17
                }).addTo(map);

                startGame();
            } catch (error) {
                console.error("Map initialization failed:", error);
                document.getElementById('question-title').textContent = "ì˜¤ë¥˜ ë°œìƒ";
                document.getElementById('question-desc').textContent = "ì§€ë„ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.";
            }
        }

        function startGame() {
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
                nextRound();
            }, 1000);
        }

        function nextRound() {
            const modal = document.getElementById('video-modal');
            const iframe = document.getElementById('reward-video');
            if(iframe) iframe.src = ""; 
            if(modal) modal.classList.add('hidden');

            isAnswered = false;
            currentRound++;
            document.getElementById('level-display').textContent = currentRound;
            
            const container = document.getElementById('options-container');
            if(container) {
                container.innerHTML = '';
                container.classList.remove('opacity-50', 'pointer-events-none');
            }
            
            // ì´ì „ ì› ì œê±°
            if (mapCircle) {
                map.removeLayer(mapCircle);
                mapCircle = null;
            }
            
            // íƒ€ì… ëœë¤ ì„ íƒ (ì§€ë„, êµ­ê¸°, ìˆ˜ë„, ë¸Œëœë“œ)
            const types = ['map', 'flag', 'capital', 'brand'];
            currentType = types[Math.floor(Math.random() * types.length)];
            
            const randomIndex = Math.floor(Math.random() * countries.length);
            currentCountry = countries[randomIndex];

            try {
                updateDisplayForRound();
            } catch (error) {
                console.error("Display update failed, fallback to map:", error);
                currentType = 'map';
                updateDisplayForRound();
            }

            createOptions();
        }

        function updateDisplayForRound() {
            const titleEl = document.getElementById('question-title');
            const descEl = document.getElementById('question-desc');
            const badgeEl = document.getElementById('quiz-type-badge');
            
            const mapContainer = document.getElementById('map-container');
            const flagContainer = document.getElementById('flag-container');
            const textContainer = document.getElementById('text-quiz-container');
            const textContent = document.getElementById('text-quiz-content');
            const flagImg = document.getElementById('flag-image');
            const quizIcon = document.getElementById('quiz-icon');

            // ëª¨ë“  ì»¨í…Œì´ë„ˆ ìˆ¨ê¹€
            mapContainer.classList.add('hidden');
            flagContainer.classList.add('hidden');
            textContainer.classList.add('hidden');

            const safeName = currentCountry.name || "Unknown";
            const safeCapital = currentCountry.capital || "Unknown (Unknown)";
            const capitalKo = safeCapital.includes('(') ? safeCapital.split('(')[0] : safeCapital;
            const capitalEn = safeCapital.includes('(') ? safeCapital.split('(')[1].replace(')', '') : '';
            const safeBrands = currentCountry.brands || [];

            if (currentType === 'map') {
                badgeEl.textContent = "ì§€ë„ í€´ì¦ˆ";
                badgeEl.className = "inline-block px-3 py-1 rounded-full text-xs font-bold text-white bg-green-600 mb-2";
                titleEl.textContent = "ğŸŒ ì´ ë‚˜ë¼ëŠ” ì–´ë””ì¼ê¹Œìš”?";
                descEl.textContent = "ì§€ë„ì— í‘œì‹œëœ ì˜ì—­ì„ ë³´ê³  ë‚˜ë¼ ì´ë¦„ì„ ë§ì¶°ë³´ì„¸ìš”!";
                mapContainer.classList.remove('hidden');
                
                setTimeout(() => {
                    map.invalidateSize();
                    map.flyTo([currentCountry.lat, currentCountry.lng], currentCountry.zoom, { duration: 1.5 });
                    
                    // ì˜ì—­ í‘œì‹œ (ì›) ì¶”ê°€ - íŒíŠ¸ ê¸°ëŠ¥
                    mapCircle = L.circle([currentCountry.lat, currentCountry.lng], {
                        color: '#22c55e',       // ì´ˆë¡ìƒ‰ í…Œë‘ë¦¬
                        fillColor: '#22c55e',   // ì´ˆë¡ìƒ‰ ì±„ì›€
                        fillOpacity: 0.2,       // íˆ¬ëª…ë„
                        radius: currentCountry.radius // ë‚˜ë¼ í¬ê¸°ì— ë§ì¶˜ ë°˜ì§€ë¦„
                    }).addTo(map);

                }, 100);
            
            } else if (currentType === 'flag') {
                badgeEl.textContent = "êµ­ê¸° í€´ì¦ˆ";
                badgeEl.className = "inline-block px-3 py-1 rounded-full text-xs font-bold text-white bg-red-500 mb-2";
                titleEl.textContent = "ğŸ³ï¸ ì´ êµ­ê¸°ëŠ” ì–´ëŠ ë‚˜ë¼ì¼ê¹Œìš”?";
                descEl.textContent = "í„ëŸ­ì´ëŠ” êµ­ê¸°ë¥¼ ë³´ê³  ì •ë‹µì„ ê³¨ë¼ë³´ì„¸ìš”!";
                flagContainer.classList.remove('hidden');
                flagImg.src = `https://flagcdn.com/h240/${currentCountry.code}.png`;
            
            } else if (currentType === 'capital') {
                badgeEl.textContent = "ìˆ˜ë„ í€´ì¦ˆ";
                badgeEl.className = "inline-block px-3 py-1 rounded-full text-xs font-bold text-white bg-indigo-600 mb-2";
                titleEl.textContent = "ğŸ™ï¸ ìˆ˜ë„ ì´ë¦„ ë§ì¶”ê¸°!";
                descEl.textContent = "ì•„ë˜ ë„ì‹œê°€ ìˆ˜ë„ì¸ ë‚˜ë¼ëŠ” ì–´ë””ì¼ê¹Œìš”?";
                textContainer.classList.remove('hidden');
                quizIcon.textContent = "ğŸ™ï¸";
                textContent.innerHTML = `<span class="text-4xl text-blue-600">${capitalKo}</span><br><span class="text-base text-gray-400 font-normal mt-2">${capitalEn}</span>`;
            
            } else if (currentType === 'brand') {
                badgeEl.textContent = "ë¸Œëœë“œ í€´ì¦ˆ";
                badgeEl.className = "inline-block px-3 py-1 rounded-full text-xs font-bold text-white bg-orange-500 mb-2";
                titleEl.textContent = "ğŸ‘œ ìœ ëª… ë¸Œëœë“œì˜ ê³ í–¥ì€?";
                descEl.textContent = "ì´ ë¡œê³ ë“¤ì˜ ë³¸ê³ ì¥ì€ ì–´ë””ì¼ê¹Œìš”?";
                textContainer.classList.remove('hidden');
                quizIcon.textContent = "ğŸ‘œ";
                
                // ë¸Œëœë“œ 'ì¹´ë“œ' ìŠ¤íƒ€ì¼ë¡œ í‘œì‹œ (ë¡œê³  ëŒ€ì²´)
                const brandList = safeBrands.map(b => `
                    <div class="brand-card">
                        ${b}
                    </div>
                `).join('');
                textContent.innerHTML = `<div class="flex flex-wrap justify-center items-center">${brandList}</div>`;
            }
        }

        function createOptions() {
            try {
                let options = [currentCountry];
                const otherCountries = countries.filter(c => c.name !== currentCountry.name);
                const shuffledOthers = otherCountries.sort(() => 0.5 - Math.random()).slice(0, 3);
                options = options.concat(shuffledOthers);
                options.sort(() => 0.5 - Math.random());

                const container = document.getElementById('options-container');
                options.forEach(option => {
                    const btn = document.createElement('button');
                    btn.className = "option-btn bg-white hover:bg-slate-50 border-2 border-slate-200 text-slate-700 font-semibold py-4 px-2 rounded-lg shadow-sm transition-all active:scale-95 text-sm sm:text-base break-keep";
                    
                    const btnText = option.name.includes('(') ? option.name.split('(')[0] : option.name;
                    btn.textContent = btnText;
                    
                    btn.onclick = () => checkAnswer(option, btn);
                    container.appendChild(btn);
                });
            } catch (error) {
                console.error("Error creating options:", error);
                const container = document.getElementById('options-container');
                container.innerHTML = '<p class="col-span-2 text-center text-red-500">ë³´ê¸° ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.</p>';
            }
        }

        function checkAnswer(selected, btnElement) {
            if (isAnswered) return;
            isAnswered = true;
            const container = document.getElementById('options-container');

            const btnText = selected.name.includes('(') ? selected.name.split('(')[0] : selected.name;

            if (selected.name === currentCountry.name) {
                // ì •ë‹µ
                score += 10;
                document.getElementById('score').textContent = score;
                btnElement.classList.add('bg-green-100', 'border-green-500', 'text-green-700', 'correct-anim');
                
                setTimeout(() => {
                    openModal(currentCountry);
                }, 800);

            } else {
                // ì˜¤ë‹µ
                btnElement.classList.add('bg-red-100', 'border-red-500', 'text-red-700');
                
                // ì •ë‹µ ë²„íŠ¼ í‘œì‹œ
                const buttons = container.getElementsByTagName('button');
                const correctName = currentCountry.name.includes('(') ? currentCountry.name.split('(')[0] : currentCountry.name;
                
                for (let btn of buttons) {
                    if (btn.textContent === correctName) {
                        btn.classList.add('bg-green-100', 'border-green-500', 'text-green-700');
                    }
                }
                setTimeout(() => {
                    nextRound();
                }, 2000);
            }
            container.classList.add('pointer-events-none');
        }

        function openModal(country) {
            const modal = document.getElementById('video-modal');
            const iframe = document.getElementById('reward-video');
            const desc = document.getElementById('modal-desc');

            let videoId = country.videoId;
            const defaultVideoId = "P_upO4tqLTk"; 
            
            if(!videoId || videoId.includes('_wE_w')) { 
                videoId = defaultVideoId;
                desc.textContent = `${country.name.split('(')[0]}ì˜ ë©‹ì§„ ì˜ìƒì„ ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤. ëŒ€ì‹  ì•„ë¦„ë‹¤ìš´ ì•„ì‹œì•„ í’ê²½ì„ ê°ìƒí•˜ì„¸ìš”!`;
            } else {
                desc.innerHTML = `<span class="font-bold text-blue-600">${country.name.split('(')[0]}</span>ì— ëŒ€í•´ ë” ì•Œì•„ë³´ì„¸ìš”! (ê´€ê´‘ì²­/ê³µì‹ ì˜ìƒ)`;
            }

            iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&showinfo=0`;
            modal.classList.remove('hidden');
        }

        function closeModal() {
            const modal = document.getElementById('video-modal');
            const iframe = document.getElementById('reward-video');
            iframe.src = ""; 
            modal.classList.add('hidden');
            
            if(isAnswered) {
                 nextRound();
            }
        }

        window.onload = initMap;
    </script>
</body>
</html>